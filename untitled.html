<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Contacts</title>
	
	
</head>
<body>
	<h1>Contacts</h1>

<select>
  <option>Company</option>
  <option>Name</option>
  <option>Dept</option>
  <option>Phone</option>
  <option>Dept</option>
</select>

	
	<form id="contacts-form">
		<div class="formText">
			<label>Company:</label>
			<div class="field"><input type="text" name="company" /></div>
		</div>
		<div class="formText">
			<label>Name:</label>
			<div class="field"><input type="text" name="fullName" /></div>
		</div>
		<div class="formText">
			<label>Dept:</label>
			<div class="field"><input type="text" name="dept" /></div>
		</div>
		<div class="formText">
			<label>Phone:</label>
			<div class="field"><input type="text" name="phone" /></div>
		</div>

		<div class="formText">
			<label>Email:</label>
			<div class="field"><input type="text" name="email" /></div>
		</div>
		<div class="button-wrapper">
			<div class="item button">
				<div class="field"><input type="button" id="contacts-op-discard" value="Discard" /></div>
			</div>
			<div class="item button button-default">
				<div class="field"><input type="submit" id="contacts-op-save" value="Save" /></div>
			</div>
		</div>
		<input type="hidden" name="idEntry" value="0" />
	</form>

<hr>
	<table id="contacts-table">
		<tr id="contacts-head">
			<th>ID</th>
			<th>Company</th>
			<th>Name</th>
			<th>Dept</th>
			<th>Phone</th>
			<th>Email</th>
			<th>Actions</th>
		</tr>
	</table>

	<script>
		var Contacts = {
			index: window.localStorage.getItem("Contacts:index"),
			$table: document.getElementById("contacts-table"),
			$form: document.getElementById("contacts-form"),
			$button_save: document.getElementById("contacts-op-save"),
			$button_discard: document.getElementById("contacts-op-discard"),

			init: function() {
				// initialize storage index
				if (!Contacts.index) {
					window.localStorage.setItem("Contacts:index", Contacts.index = 1);
				}

				// initialize form
				Contacts.$form.reset();
				Contacts.$button_discard.addEventListener("click", function(event) {
					Contacts.$form.reset();
					Contacts.$form.idEntry.value = 0;
				}, true);
				Contacts.$form.addEventListener("submit", function(event) {
					var entry = {
						id: parseInt(this.idEntry.value),
						company: this.company.value,
						fullName: this.fullName.value,
						Dept: this.dept.value,
						Phone: this.phone.value,
						email: this.email.value
					};
					if (entry.id == 0) { // add
						Contacts.storeAdd(entry);
						Contacts.tableAdd(entry);
					}
					else { // edit
						Contacts.storeEdit(entry);
						Contacts.tableEdit(entry);
					}

					this.reset();
					this.idEntry.value = 0;
					event.preventDefault();
				}, true);

				// initialize table
				if (window.localStorage.length - 1) {
					var contacts_list = [], i, key;
					for (i = 0; i < window.localStorage.length; i++) {
						key = window.localStorage.key(i);
						if (/Contacts:\d+/.test(key)) {
							contacts_list.push(JSON.parse(window.localStorage.getItem(key)));
						}
					}
					// sorts contact list

					//Unfortunately there is no generic "compare" function in JavaScript to return a suitable value for sort(). I'd write a compareStrings function that uses comparison operators and then use it in the sort function.

					//Why does the comparison between a<b work? Does that know to check the characters for order?
					//The comparison works because < and friends are defined to use lexicographical ordering for strings. Internally it checks each matching character and when it finds two different Unicode values, it returns, which results in "dictionary" ordering. This is also why I added toLowerCase() calls just in case, because the comparison itself compares codepoint values only. It doesn't check for case.

				if (contacts_list.length) {
						function compareStrings(a, b) {
							a = a.toLowerCase();
							b = b.toLowerCase();
						return (a < b) ? -1 : (a > b) ? 1 : 0;
						}
						contacts_list.sort(function(a, b) {
						  return compareStrings(a.Phone, b.Phone);
						})
						.forEach(Contacts.tableAdd);
					}
				}

				Contacts.$table.addEventListener("click", function(event) {
					var op = event.target.getAttribute("data-op");
					if (/edit|remove/.test(op)) {
						var entry = JSON.parse(window.localStorage.getItem("Contacts:"+ event.target.getAttribute("data-id")));
						if (op == "edit") {
							Contacts.$form.company.value = entry.company;
							Contacts.$form.fullName.value = entry.fullName;
							Contacts.$form.dept.value = entry.dept;
							Contacts.$form.phone.value = entry.phone;
							Contacts.$form.email.value = entry.email;
							Contacts.$form.idEntry.value = entry.id;
						}
						else if (op == "remove") {
							if (confirm('Are you sure you want to remove "'+ entry.fullName +'" from your contacts?')) {
								Contacts.storeRemove(entry);
								Contacts.tableRemove(entry);
							}
						}
						event.preventDefault();
					}
				}, true);
			},

			storeAdd: function(entry) {
				entry.id = Contacts.index;
				window.localStorage.setItem("Contacts:index", ++Contacts.index);
				window.localStorage.setItem("Contacts:"+ entry.id, JSON.stringify(entry));
			},
			storeEdit: function(entry) {
				window.localStorage.setItem("Contacts:"+ entry.id, JSON.stringify(entry));
			},
			storeRemove: function(entry) {
				window.localStorage.removeItem("Contacts:"+ entry.id);
			},

			tableAdd: function(entry) {
				var $tr = document.createElement("tr"), $td, key;
				for (key in entry) {
					if (entry.hasOwnProperty(key)) {
						$td = document.createElement("td");
						$td.appendChild(document.createTextNode(entry[key]));
						$tr.appendChild($td);
					}
				}
				$td = document.createElement("td");
				$td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
				$tr.appendChild($td);
				$tr.setAttribute("id", "entry-"+ entry.id);
				Contacts.$table.appendChild($tr);
			},
			tableEdit: function(entry) {
				var $tr = document.getElementById("entry-"+ entry.id), $td, key;
				$tr.innerHTML = "";
				for (key in entry) {
					if (entry.hasOwnProperty(key)) {
						$td = document.createElement("td");
						$td.appendChild(document.createTextNode(entry[key]));
						$tr.appendChild($td);
					}
				}
				$td = document.createElement("td");
				$td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
				$tr.appendChild($td);
			},
			tableRemove: function(entry) {
				Contacts.$table.removeChild(document.getElementById("entry-"+ entry.id));
			}
		};
		Contacts.init();
	</script>
</body>
</html>
