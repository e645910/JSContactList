<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Contacts List</title>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
<body>
    <div class="headerContainer">
        <div class="header">
            <h1>Ricks Company Contacts</h1>
        </div>
    </div>
    

    <form class="formContainer" id="contacts-form">

        <div class="formCompanyContainer">
            <div class="formCompany">
                <div>
                    <label>Company:</label>
                    <div><input type="text" name="company" /></div>
                </div>
                <div>
                    <label>Address 1:</label>
                    <div><input type="text" name="address1" /></div>
                </div>
                <div>
                    <label>Address 2:</label>
                    <div><input type="text" name="address2" /></div>
                </div>      
                <div>
                    <label>City:</label>
                    <div><input type="text" name="city" /></div>
                </div>
                <div>
                    <label>State:</label>
                    <div><input type="text" name="state" /></div>
                </div>
                <div>
                    <label>Zip Code:</label>
                    <div><input type="number" name="zip" /></div>
                </div>
            </div>
        </div>
        
        <div class="formCompanyNotesContainer">
            <div>
                <label>Notes:</label>
                <textarea name="notes" wrap="soft"></textarea>
                </div>
            </div>
        </div>

        <div class="formPersonContainer">
            <div class="formPersonal">
                <div>
                    <label>Name:</label>
                    <div><input type="text" name="fullName" placeholder="Enter First and Last Name"/></div>
                </div>
                <div>
                    <label>Dept:</label>
                    <div><input type="text" name="dept" /></div>
                </div>
                <div>
                    <label>Phone:</label>
                    <div><input type="text" name="phone" /></div>
                </div>

                <div>
                    <label>Email:</label>
                    <div><input type="email" name="email" placeholder="Enter Email Format"/></div>
                </div>
            </div>
        </div>
            <div class="buttonContainer">
                <div class="itemButton">
                    <div><input type="button" id="contacts-op-discard" value="Clear" /></div>
                    <div><input type="submit" id="contacts-op-save" value="Save" /></div>
                </div>
            </div>
            <input type="hidden" name="idEntry" value="0" />

    </form>

    <table class="tableContainer" id="contacts-table">
            <tr>
                <th>ID</th>
                <th>Company</th>
                <th>Address1</th>
                <th>Address2</th>
                <th>City</th>
                <th>State</th>
                <th>Zip</th>
                <th>Notes</th>
                <th>fullName</th>
                <th>Dept</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Actions</th>
            </tr>
    </table>

<script>
// =================set up the DOM ==========================================
var Contacts = {
    index: window.localStorage.getItem("Contacts:index"),
    $table: document.getElementById("contacts-table"),
    $form: document.getElementById("contacts-form"),
    $button_save: document.getElementById("contacts-op-save"),
    $button_discard: document.getElementById("contacts-op-discard"),
    
    init: function() {
// =================== initialize storage index =============================
        if (!Contacts.index) {
            window.localStorage.setItem("Contacts:index", Contacts.index = 1);
        }

// ==================== initialize form ======================================
        Contacts.$form.reset();
        Contacts.$button_discard.addEventListener("click", function(event) {
            Contacts.$form.reset();
            Contacts.$form.idEntry.value = 0;
        }, true);
        Contacts.$form.addEventListener("submit", function(event) {
            var entry = {
                id: parseInt(this.idEntry.value),
                company: this.company.value,
                address1: this.address1.value,
                address2: this.address2.value,
                city: this.city.value,
                state: this.state.value,
                zip: this.zip.value,
                notes: this.notes.value,
                fullName: this.fullName.value,
                dept: this.dept.value,
                phone: this.phone.value,
                email: this.email.value
            };
        if (entry.id == 0) {
            Contacts.storeAdd(entry);
            Contacts.tableAdd(entry);
        }
        else { 
            Contacts.storeEdit(entry);
            Contacts.tableEdit(entry);
        }

        this.reset();
        this.idEntry.value = 0;
        event.preventDefault();
        }, true);

// ================= initialize table =======================================
        if (window.localStorage.length - 1) {
            var contacts_list = [], i, key;
            for (i = 0; i < window.localStorage.length; i++) {
                key = window.localStorage.key(i);
                if (/Contacts:\d+/.test(key)) {
                    contacts_list.push(JSON.parse(window.localStorage.getItem(key)));
                }
            }
            contacts_list.forEach(Contacts.tableShow)
window.localStorage.clear();
        // ==== sorts the database =========================================
        //     function scopepreserver() {
        //         return function() {
        //         var string = this.innerText;
        //         var tableHeader = string.toLowerCase();
        //         var headerA;
        //         var headerB;
        //         console.log('tableHeader= ', tableHeader)
        //             if (contacts_list.length) {
        //                 contacts_list
        //                     .sort(function(a, b) {
        //                         console.log(22222222, a.tableHeader)

        //                         for(var key in a){
        //                             if(key === tableHeader){
        //                                 a.tableHeader = key;
        //                                 console.log("THE WHOLE FRIGGIN OBJECT", a)
        //                                 console.log("LOOK HERE IT'S WORKING", a.tableHeader);
        //                             }
        //                         }

        //                     })
        //                 .forEach(Contacts.tableAdd);
        //             }   //localStorage.clear();
        //         };
        //     }
        // } console.log(1111111, contacts_list)
        // ===== keeps scope from being lost and starts sort based on "th" selection 
        function myfunction() {

           window.localStorage.clear()


          // var titles = document.getElementsByTagName("th");
          // var rows = document.getElementsByTagName("tr");
          // for( var i = 0; i < titles.length; i++ ) {
          //   titles[i].onclick = scopepreserver( i, rows[i]);
          }
        }
        myfunction();

// ======== display info when a record is selected to be removed  ============
        Contacts.$table.addEventListener("click", function(event) {
            var op = event.target.getAttribute("data-op");
            if (/edit|remove/.test(op)) {
                var entry = JSON.parse(window.localStorage.getItem("Contacts:"+ event.target.getAttribute("data-id")));
                if (op == "edit") {
                    Contacts.$form.company.value = entry.company;
                    Contacts.$form.address1.value = entry.address1;
                    Contacts.$form.address2.value = entry.address2;
                    Contacts.$form.city.value = entry.city;
                    Contacts.$form.state.value = entry.state;
                    Contacts.$form.zip.value = entry.zip;
                    Contacts.$form.notes.value = entry.notes;
                    Contacts.$form.fullName.value = entry.fullName;
                    Contacts.$form.dept.value = entry.dept;
                    Contacts.$form.phone.value = entry.phone;
                    Contacts.$form.email.value = entry.email;
                    Contacts.$form.idEntry.value = entry.id;
                }
                else if (op == "remove") {
                    if (confirm('Are you sure you want to remove "'+ entry.fullName +'" from your contacts?')) {
                        Contacts.storeRemove(entry);
                        Contacts.tableRemove(entry);
                    }
                }
                event.preventDefault();
            }
        }, true);
    },

// =============== show data ==============
        tableShow: function(entry) {
            var $tr = document.createElement("tr"), $td, key;
            for (key in entry) {
                if (entry.hasOwnProperty(key)) {
                    $td = document.createElement("td");
                    $td.appendChild(document.createTextNode(entry[key]));
                    $tr.appendChild($td);
                }
            }
            $td = document.createElement("td");
            $td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
            $tr.appendChild($td);
            $tr.setAttribute("id", "entry-"+ entry.id);
            Contacts.$table.appendChild($tr);
        },



// =============== create, update, delete individual contacts ==============    

        storeAdd: function(entry) {
        entry.id = Contacts.index;
        window.localStorage.setItem("Contacts:index", ++Contacts.index);
        window.localStorage.setItem("Contacts:"+ entry.id, JSON.stringify(entry));
        },
        storeEdit: function(entry) {
            window.localStorage.setItem("Contacts:"+ entry.id, JSON.stringify(entry));
        },
        storeRemove: function(entry) {
            window.localStorage.removeItem("Contacts:"+ entry.id);
        },

        tableAdd: function(entry) {
            var $tr = document.createElement("tr"), $td, key;
            for (key in entry) {
                if (entry.hasOwnProperty(key)) {
                    $td = document.createElement("td");
                    $td.appendChild(document.createTextNode(entry[key]));
                    $tr.appendChild($td);
                }
            }
            $td = document.createElement("td");
            $td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
            $tr.appendChild($td);
            $tr.setAttribute("id", "entry-"+ entry.id);
            Contacts.$table.appendChild($tr);
        },

        tableEdit: function(entry) {
            var $tr = document.getElementById("entry-"+ entry.id), $td, key;
            $tr.innerHTML = "";
            for (key in entry) {
                if (entry.hasOwnProperty(key)) {
                    $td = document.createElement("td");
                    $td.appendChild(document.createTextNode(entry[key]));
                    $tr.appendChild($td);
                }
            }
            $td = document.createElement("td");
            $td.innerHTML = '<a data-op="edit" data-id="'+ entry.id +'">Edit</a> | <a data-op="remove" data-id="'+ entry.id +'">Remove</a>';
            $tr.appendChild($td);
        },

        tableRemove: function(entry) {
            Contacts.$table.removeChild(document.getElementById("entry-"+ entry.id));
        }
    };
    Contacts.init();

</script>

</body>
</html>